<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>All-in-one Offline PDF Tools</title>

<!-- Libraries -->
<script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.14.305/pdf.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

<style>
  :root{
    --bg1:#f4f8fb; --accent1:#4f8ef7; --accent2:#7b61ff; --accent3:#2ecc71;
    --card:#ffffff; --muted:#6b7280;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:Inter, "Segoe UI", Roboto, Arial; background:linear-gradient(135deg,var(--bg1),#ffffff); color:#111;}
  header{background:linear-gradient(90deg,var(--accent1),var(--accent2)); color:white; padding:20px; text-align:center; font-size:20px; font-weight:700;}
  .container{max-width:1100px;margin:24px auto;padding:16px;}
  .subtitle{color:var(--muted); text-align:center; margin:8px 0 24px;}
  .grid{display:flex;flex-wrap:wrap;gap:18px; justify-content:center;}
  .card{background:var(--card);width:220px;border-radius:12px;padding:18px;box-shadow:0 6px 18px rgba(16,24,40,0.06);cursor:pointer;text-align:left}
  .card:hover{transform:translateY(-6px);transition:0.2s}
  .card .ico{font-size:30px;margin-bottom:8px}
  .tools-bar{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin:12px 0;}
  .btn{background:var(--accent1);color:white;border:none;padding:10px 14px;border-radius:8px;cursor:pointer;font-weight:600}
  .btn.secondary{background:#fff;border:1px solid #e6e9ef;color:#111}
  .btn.red{background:#ef4444}
  .section{display:none;padding:16px;margin-top:12px;background:#fff;border-radius:12px;box-shadow:0 8px 24px rgba(15,23,42,0.05)}
  .active{display:block}
  .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap;margin:12px 0}
  input[type="file"]{display:inline-block}
  label{font-weight:600;color:#111}
  iframe{width:100%;height:70vh;border:1px solid #e6e9ef;border-radius:8px;margin-top:12px}
  .thumbs{display:flex;flex-wrap:wrap;gap:10px;margin-top:12px}
  .thumb{width:120px;border-radius:8px;padding:6px;background:#fff;border:1px solid #e6e9ef; text-align:center}
  .thumb canvas{width:100%;height:auto;border-radius:4px}
  .thumb .pnum{font-size:12px;color:var(--muted);margin-top:6px}
  .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
  .input-inline{padding:8px;border-radius:8px;border:1px solid #e6e9ef}
  .form-row{display:flex;gap:8px;align-items:center;margin:8px 0}
  .small{font-size:13px;color:var(--muted)}
  footer{margin:24px 0;text-align:center;color:var(--muted);font-size:13px}
  @media(max-width:720px){ .card{width:100%} .thumb{width:40%} }
</style>
</head>
<body>
<header>All-in-One Offline PDF Tools ‚Äî Merge ¬∑ Organize ¬∑ Watermark ¬∑ Page Numbers ¬∑ Image‚ÜíPDF</header>

<div class="container">
  <p class="subtitle">All processing happens locally in your browser ‚Äî nothing is uploaded anywhere.</p>

  <!-- HOME -->
  <div id="home" class="active section">
    <div class="grid">
      <div class="card" onclick="openSection('mergeSection')">
        <div class="ico">üìé</div><strong>Merge PDF</strong>
        <div class="small">Select multiple PDFs and combine into one.</div>
      </div>

      <div class="card" onclick="openSection('organizeSection')">
        <div class="ico">üéõÔ∏è</div><strong>Organize PDF</strong>
        <div class="small">Thumbnail viewer ‚Ä¢ Delete pages ‚Ä¢ Split into single pages</div>
      </div>

      <div class="card" onclick="openSection('numberSection')">
        <div class="ico">üî¢</div><strong>Add Page Numbers</strong>
        <div class="small">Automatic or manual page number style and placement</div>
      </div>

      <div class="card" onclick="openSection('watermarkSection')">
        <div class="ico">üíß</div><strong>Add Watermark</strong>
        <div class="small">Text watermark with color, size, rotation & opacity</div>
      </div>

      <div class="card" onclick="openSection('img2pdfSection')">
        <div class="ico">üñºÔ∏è</div><strong>Image ‚Üí PDF</strong>
        <div class="small">Convert JPG/PNG images to a PDF</div>
      </div>
    </div>
  </div>

  <!-- Back -->
  <div class="tools-bar" style="justify-content:flex-start;margin-top:18px">
    <button id="backHomeBtn" class="btn secondary" style="display:none" onclick="goHome()">‚Üê Back to Home</button>
  </div>

  <!-- Merge Section -->
  <div id="mergeSection" class="section">
    <h3>Merge PDFs</h3>
    <div class="row">
      <input id="mergeFiles" type="file" accept="application/pdf" multiple>
      <button class="btn" onclick="mergePdfAction()">Merge & View</button>
      <button class="btn secondary" onclick="downloadLastResult()">Download Result</button>
    </div>
    <div class="small">Select files in the order you want them merged.</div>
    <div id="mergeViewerWrap"></div>
  </div>

  <!-- Organize Section -->
  <div id="organizeSection" class="section">
    <h3>Organize PDF (Thumbnail editor)</h3>
    <div class="row">
      <input id="orgFile" type="file" accept="application/pdf">
      <button class="btn" onclick="loadOrganize()">Load & Show Thumbnails</button>
      <button class="btn secondary" onclick="downloadEditedPdf()">Download Edited PDF</button>
      <button class="btn" onclick="splitToSingleZipped()">Split ‚Üí Single Pages (ZIP)</button>
    </div>
    <div class="small">Click ‚ùå on any thumbnail to remove that page. After editing click Download Edited PDF.</div>

    <div id="organizeControls" class="form-row" style="display:none">
      <button class="btn" onclick="keepOnlySelected()">‚úÖ Keep Only Selected</button>
      <button class="btn secondary" onclick="resetOrganize()">Reset (reload original)</button>
    </div>

    <div id="thumbContainer" class="thumbs"></div>
    <div id="orgViewerWrap"></div>
  </div>

  <!-- Page Numbers Section -->
  <div id="numberSection" class="section">
    <h3>Add Page Numbers</h3>
    <div class="row">
      <input id="numFile" type="file" accept="application/pdf">
      <button class="btn" onclick="applyPageNumbers()">Add Page Numbers & View</button>
      <button class="btn secondary" onclick="downloadLastResult()">Download Result</button>
    </div>

    <div class="form-row">
      <label>Style:</label>
      <input id="numStyle" class="input-inline" placeholder="e.g. Page {n} of {total}" value="Page {n} of {total}">
      <label>Position:</label>
      <select id="numPos" class="input-inline">
        <option value="br">Bottom Right</option>
        <option value="bc">Bottom Center</option>
        <option value="bl">Bottom Left</option>
      </select>
      <label>Size:</label>
      <input id="numSize" class="input-inline" type="number" value="10" min="6" max="48" style="width:72px">
    </div>
    <div class="small">Choose style and size, then click Add Page Numbers.</div>
    <div id="numberViewerWrap"></div>
  </div>

  <!-- Watermark Section -->
  <div id="watermarkSection" class="section">
    <h3>Add Watermark</h3>
    <div class="row">
      <input id="wmFile" type="file" accept="application/pdf">
      <button class="btn" onclick="applyWatermark()">Add Watermark & View</button>
      <button class="btn secondary" onclick="downloadLastResult()">Download Result</button>
    </div>

    <div class="form-row">
      <label>Text:</label>
      <input id="wmText" class="input-inline" placeholder="CONFIDENTIAL" value="CONFIDENTIAL">
      <label>Size:</label>
      <input id="wmSize" class="input-inline" type="number" value="60" style="width:80px">
    </div>

    <div class="form-row">
      <label>Color:</label>
      <input id="wmColor" class="input-inline" type="color" value="#ff0000">
      <label>Opacity:</label>
      <input id="wmOpacity" class="input-inline" type="number" min="0" max="1" step="0.1" value="0.12" style="width:80px">
      <label>Rotate:</label>
      <input id="wmRotate" class="input-inline" type="number" value="-30" style="width:80px">
    </div>

    <div class="small">Set watermark text, color, size and rotation. Click Add Watermark to apply.</div>
    <div id="watermarkViewerWrap"></div>
  </div>

  <!-- Image to PDF -->
  <div id="img2pdfSection" class="section">
    <h3>Image ‚Üí PDF</h3>
    <div class="row">
      <input id="imgFiles" type="file" accept="image/*" multiple>
      <button class="btn" onclick="imagesToPdf()">Convert & View</button>
      <button class="btn secondary" onclick="downloadLastResult()">Download Result</button>
    </div>
    <div class="small">Select images in the order you want them in the PDF.</div>
    <div id="imgViewerWrap"></div>
  </div>

  <footer>Made with pdf-lib ‚Ä¢ PDF.js ‚Ä¢ JSZip ‚Äî 100% offline</footer>
</div>

<script>
/* ========== Globals ========== */
let lastResultBlob = null;       // last produced PDF blob (for download)
let orgOriginalBytes = null;     // original bytes loaded for organizer
let orgPdfDoc = null;            // pdf-lib PDFDocument for organizer
let orgKeep = [];                // boolean array: true = keep, false = deleted
let pdfjsLib = window['pdfjs-dist/build/pdf'] || window['pdfjsLib'];
if (!pdfjsLib) pdfjsLib = window.pdfjsLib; // try common name
// set worker path for PDF.js (cdnjs)
if (pdfjsLib && pdfjsLib.GlobalWorkerOptions) {
  pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.14.305/pdf.worker.min.js';
}

/* ---------- UI Helpers ---------- */
function openSection(id){
  document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  document.getElementById('home').classList.remove('active');
  document.getElementById('backHomeBtn').style.display = 'inline-block';
  // clear previous viewer containers
  ['mergeViewerWrap','orgViewerWrap','numberViewerWrap','watermarkViewerWrap','imgViewerWrap'].forEach(idc=>{
    const el = document.getElementById(idc); if(el) el.innerHTML='';
  });
  lastResultBlob = null; // new tool
}
function goHome(){
  document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
  document.getElementById('home').classList.add('active');
  document.getElementById('backHomeBtn').style.display = 'none';
  // revoke blob url if present
  if (lastResultBlob) { URL.revokeObjectURL(window._lastUrl || ''); lastResultBlob = null; }
}

/* ---------- Utility: download blob ---------- */
function downloadBlob(blob, filename='result.pdf'){
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = filename;
  document.body.appendChild(a); a.click(); a.remove();
  // remember to revoke later
  setTimeout(()=>URL.revokeObjectURL(url), 2000);
}

/* set last result for "download" button and show viewer iframe */
function setLastResultAndPreview(blob, containerId){
  lastResultBlob = blob;
  const url = URL.createObjectURL(blob);
  window._lastUrl = url;
  const wrap = document.getElementById(containerId);
  if(!wrap) return;
  wrap.innerHTML = `<iframe src="${url}"></iframe>`;
}

/* generic download last result */
function downloadLastResult(){
  if(!lastResultBlob) return alert('No result available yet ‚Äî run an action first.');
  downloadBlob(lastResultBlob, 'edited.pdf');
}

/* read file to ArrayBuffer */
function readAsArrayBuffer(file){ return file.arrayBuffer(); }

/* ---------- MERGE ---------- */
async function mergePdfAction(){
  const input = document.getElementById('mergeFiles');
  if(!input.files.length) return alert('Select PDF files to merge (multiple).');
  try{
    const merged = await PDFLib.PDFDocument.create();
    // append in order
    for (const f of input.files){
      const arr = await readAsArrayBuffer(f);
      const src = await PDFLib.PDFDocument.load(arr);
      const ids = src.getPageIndices();
      const copied = await merged.copyPages(src, ids);
      copied.forEach(p => merged.addPage(p));
    }
    const bytes = await merged.save();
    const blob = new Blob([bytes],{type:'application/pdf'});
    setLastResultAndPreview(blob,'mergeViewerWrap');
    alert('Merged ‚Äî preview available. Click Download Result to save.');
  }catch(e){console.error(e); alert('Error merging: '+e.message)}
}

/* ---------- ORGANIZE (thumbnails + delete + split single pages zipped) ---------- */

async function loadOrganize(){
  const input = document.getElementById('orgFile');
  if(!input.files.length) return alert('Choose a PDF file first.');
  const f = input.files[0];
  orgOriginalBytes = await readAsArrayBuffer(f);
  // prepare pdf-lib doc
  orgPdfDoc = await PDFLib.PDFDocument.load(orgOriginalBytes);
  const total = orgPdfDoc.getPageCount();
  orgKeep = Array(total).fill(true);
  // render thumbnails
  await renderThumbnails(orgOriginalBytes);
  document.getElementById('organizeControls').style.display = 'flex';
  document.getElementById('orgViewerWrap').innerHTML = '';
}

async function renderThumbnails(bytes){
  const container = document.getElementById('thumbContainer');
  container.innerHTML = '<div class="small">Rendering thumbnails...</div>';
  // use PDF.js
  const loadingTask = pdfjsLib.getDocument({data: bytes});
  const pdf = await loadingTask.promise;
  const total = pdf.numPages;
  container.innerHTML = '';
  for(let i=1;i<=total;i++){
    const page = await pdf.getPage(i);
    const viewport = page.getViewport({scale: 0.6});
    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d');
    canvas.width = Math.floor(viewport.width);
    canvas.height = Math.floor(viewport.height);
    await page.render({canvasContext: ctx, viewport}).promise;
    const thumb = document.createElement('div');
    thumb.className='thumb';
    const canvasWrap = document.createElement('div');
    canvasWrap.appendChild(canvas);
    const pnum = document.createElement('div');
    pnum.className='pnum';
    pnum.innerHTML = `Page ${i} <button data-page="${i-1}" style="margin-left:6px" onclick="toggleDeletePage(event)">‚ùå</button>`;
    // selection checkbox
    pnum.innerHTML += ` <input type="checkbox" data-page="${i-1}" checked onchange="toggleSelectPage(event)" style="margin-left:6px"> keep`;
    thumb.appendChild(canvasWrap);
    thumb.appendChild(pnum);
    container.appendChild(thumb);
  }
  // make sure orgKeep length matches
  orgKeep = Array(total).fill(true);
}

/* clicking ‚ùå toggles keep false and updates checkbox/opacity */
function toggleDeletePage(e){
  e.stopPropagation();
  const p = Number(e.currentTarget.getAttribute('data-page'));
  orgKeep[p] = false;
  // update UI: find corresponding checkbox and uncheck & dim canvas
  const chk = document.querySelector(`input[type=checkbox][data-page="${p}"]`);
  if(chk){ chk.checked = false; }
  const thumb = e.currentTarget.closest('.thumb');
  if(thumb) thumb.style.opacity = '0.35';
}

/* checkbox toggles keep */
function toggleSelectPage(e){
  const p = Number(e.currentTarget.getAttribute('data-page'));
  orgKeep[p] = e.currentTarget.checked;
  const thumb = e.currentTarget.closest('.thumb');
  if(thumb) thumb.style.opacity = orgKeep[p] ? '1' : '0.35';
}

/* keep only selected (creates new pdf with selected pages and previews) */
async function keepOnlySelected(){
  if(!orgOriginalBytes) return alert('Load a PDF first.');
  try{
    const src = await PDFLib.PDFDocument.load(orgOriginalBytes);
    const out = await PDFLib.PDFDocument.create();
    const indices = src.getPageIndices();
    const keepIndices = indices.filter(i=>orgKeep[i]);
    if(keepIndices.length === 0) return alert('No pages selected to keep.');
    const copied = await out.copyPages(src, keepIndices);
    copied.forEach(p=> out.addPage(p));
    const bytes = await out.save();
    const blob = new Blob([bytes],{type:'application/pdf'});
    setLastResultAndPreview(blob,'orgViewerWrap');
    alert('Edited PDF ready ‚Äî preview shown. Click Download Edited PDF to save.');
  }catch(e){console.error(e); alert('Error creating edited PDF: '+e.message)}
}

/* reset organizer to original */
async function resetOrganize(){
  if(!orgOriginalBytes) return;
  await renderThumbnails(orgOriginalBytes);
  document.getElementById('orgViewerWrap').innerHTML='';
  lastResultBlob = null;
}

/* split each page into single PDF and zip them */
async function splitToSingleZipped(){
  if(!orgOriginalBytes) return alert('Load a PDF first.');
  try{
    const src = await PDFLib.PDFDocument.load(orgOriginalBytes);
    const total = src.getPageCount();
    const zip = new JSZip();
    for(let i=0;i<total;i++){
      const out = await PDFLib.PDFDocument.create();
      const [copied] = await out.copyPages(src,[i]);
      out.addPage(copied);
      const bytes = await out.save();
      zip.file(`page-${i+1}.pdf`, bytes);
    }
    const content = await zip.generateAsync({type:'blob'});
    // download zip
    downloadBlob(content, 'pages.zip');
  }catch(e){console.error(e); alert('Error splitting pages: '+e.message)}
}

/* downloadEditedPdf: build PDF from orgKeep and download */
async function downloadEditedPdf(){
  if(!orgOriginalBytes) return alert('Load a PDF first.');
  try{
    const src = await PDFLib.PDFDocument.load(orgOriginalBytes);
    const out = await PDFLib.PDFDocument.create();
    const indices = src.getPageIndices();
    const keepIndices = indices.filter(i=>orgKeep[i]);
    if(keepIndices.length===0) return alert('No pages selected to keep.');
    const copied = await out.copyPages(src, keepIndices);
    copied.forEach(p=> out.addPage(p));
    const bytes = await out.save();
    const blob = new Blob([bytes],{type:'application/pdf'});
    setLastResultAndPreview(blob,'orgViewerWrap');
    downloadBlob(blob, 'edited.pdf');
  }catch(e){console.error(e); alert('Error downloading edited PDF: '+e.message)}
}

/* ---------- PAGE NUMBERS ---------- */
async function applyPageNumbers(){
  const input = document.getElementById('numFile');
  if(!input.files.length) return alert('Choose a PDF first.');
  try{
    const arr = await readAsArrayBuffer(input.files[0]);
    const pdf = await PDFLib.PDFDocument.load(arr);
    const font = await pdf.embedFont(PDFLib.StandardFonts.Helvetica);
    const pages = pdf.getPages();
    const total = pages.length;
    const style = document.getElementById('numStyle').value || 'Page {n} of {total}';
    const pos = document.getElementById('numPos').value || 'br';
    const size = Number(document.getElementById('numSize').value) || 10;
    for(let i=0;i<pages.length;i++){
      const page = pages[i];
      const {width, height} = page.getSize();
      const text = style.replace('{n}', i+1).replace('{total}', total);
      const textWidth = font.widthOfTextAtSize(text, size);
      let x = 30, y = 20;
      if(pos==='br'){ x = width - textWidth - 30; y = 20; }
      if(pos==='bc'){ x = (width - textWidth)/2; y = 20; }
      if(pos==='bl'){ x = 30; y = 20; }
      page.drawText(text, {x, y, size, font, color: PDFLib.rgb(0,0,0)});
    }
    const bytes = await pdf.save();
    const blob = new Blob([bytes],{type:'application/pdf'});
    setLastResultAndPreview(blob, 'numberViewerWrap');
    alert('Page numbers added. Use Download Result to save.');
  }catch(e){console.error(e); alert('Error adding page numbers: '+e.message)}
}

/* ---------- WATERMARK ---------- */
function hexToRgb(hex){
  const h = hex.replace('#','');
  const bigint = parseInt(h,16);
  const r = (bigint >> 16) & 255;
  const g = (bigint >> 8) & 255;
  const b = bigint & 255;
  return [r/255, g/255, b/255];
}
async function applyWatermark(){
  const input = document.getElementById('wmFile');
  if(!input.files.length) return alert('Choose a PDF first.');
  try{
    const arr = await readAsArrayBuffer(input.files[0]);
    const pdf = await PDFLib.PDFDocument.load(arr);
    const font = await pdf.embedFont(PDFLib.StandardFonts.HelveticaBold);
    const pages = pdf.getPages();
    const text = (document.getElementById('wmText').value || 'CONFIDENTIAL').toString();
    const size = Number(document.getElementById('wmSize').value) || 60;
    const colorHex = document.getElementById('wmColor').value || '#ff0000';
    const opacity = Number(document.getElementById('wmOpacity').value) || 0.12;
    const rotate = Number(document.getElementById('wmRotate').value) || -30;
    const rgb = hexToRgb(colorHex);
    for(let i=0;i<pages.length;i++){
      const page = pages[i];
      const {width, height} = page.getSize();
      // center approximate
      const textWidth = font.widthOfTextAtSize(text, size);
      page.drawText(text, {
        x: (width/2) - (textWidth/2),
        y: (height/2),
        size,
        font,
        rotate: PDFLib.degrees(rotate),
        opacity,
        color: PDFLib.rgb(rgb[0], rgb[1], rgb[2])
      });
    }
    const bytes = await pdf.save();
    const blob = new Blob([bytes],{type:'application/pdf'});
    setLastResultAndPreview(blob,'watermarkViewerWrap');
    alert('Watermark applied. Click Download Result to save.');
  }catch(e){console.error(e); alert('Error applying watermark: '+e.message)}
}

/* ---------- IMAGE ‚Üí PDF ---------- */
async function imagesToPdf(){
  const input = document.getElementById('imgFiles');
  if(!input.files.length) return alert('Select one or more images.');
  try{
    const pdfDoc = await PDFLib.PDFDocument.create();
    for(const f of input.files){
      const arr = await readAsArrayBuffer(f);
      let embed;
      if(f.type.includes('png')) embed = await pdfDoc.embedPng(arr);
      else embed = await pdfDoc.embedJpg(arr);
      const {width, height} = embed.scale(1);
      const page = pdfDoc.addPage([width, height]);
      page.drawImage(embed, {x:0,y:0,width,height});
    }
    const bytes = await pdfDoc.save();
    const blob = new Blob([bytes],{type:'application/pdf'});
    setLastResultAndPreview(blob,'imgViewerWrap');
    alert('Image(s) converted. Click Download Result to save.');
  }catch(e){console.error(e); alert('Error converting images: '+e.message)}
}

</script>
</body>
</html>
